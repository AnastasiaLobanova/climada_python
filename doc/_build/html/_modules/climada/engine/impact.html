
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>climada.engine.impact &#8212; climada 1.2.4-dev documentation</title>
    <link rel="stylesheet" href="../../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><h1 style="font-size: 3em;">climada</h1></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for climada.engine.impact</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This file is part of CLIMADA.</span>

<span class="sd">Copyright (C) 2017 ETH Zurich, CLIMADA contributors listed in AUTHORS.</span>

<span class="sd">CLIMADA is free software: you can redistribute it and/or modify it under the</span>
<span class="sd">terms of the GNU Lesser General Public License as published by the Free</span>
<span class="sd">Software Foundation, version 3.</span>

<span class="sd">CLIMADA is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<span class="sd">WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A</span>
<span class="sd">PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU Lesser General Public License along</span>
<span class="sd">with CLIMADA. If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>

<span class="sd">---</span>

<span class="sd">Define Impact and ImpactFreqCurve classes.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ImpactFreqCurve&#39;</span><span class="p">,</span> <span class="s1">&#39;Impact&#39;</span><span class="p">]</span>

<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">zip_longest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">sparse</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xlsxwriter</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>

<span class="kn">from</span> <span class="nn">climada.entity.tag</span> <span class="k">import</span> <span class="n">Tag</span>
<span class="kn">from</span> <span class="nn">climada.entity.exposures.base</span> <span class="k">import</span> <span class="n">Exposures</span><span class="p">,</span> <span class="n">DEF_CRS</span>
<span class="kn">from</span> <span class="nn">climada.hazard.tag</span> <span class="k">import</span> <span class="n">Tag</span> <span class="k">as</span> <span class="n">TagHaz</span>
<span class="kn">from</span> <span class="nn">climada.entity.exposures.base</span> <span class="k">import</span> <span class="n">INDICATOR_IF</span><span class="p">,</span> <span class="n">INDICATOR_CENTR</span>
<span class="kn">import</span> <span class="nn">climada.util.plot</span> <span class="k">as</span> <span class="nn">u_plot</span>
<span class="kn">from</span> <span class="nn">climada.util.config</span> <span class="k">import</span> <span class="n">CONFIG</span>

<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="Impact"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact">[docs]</a><span class="k">class</span> <span class="nc">Impact</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Impact definition. Compute from an entity (exposures and impact</span>
<span class="sd">    functions) and hazard.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        tag (dict): dictionary of tags of exposures, impact functions set and</span>
<span class="sd">            hazard: {&#39;exp&#39;: Tag(), &#39;if_set&#39;: Tag(), &#39;haz&#39;: TagHazard()}</span>
<span class="sd">        event_id (np.array): id (&gt;0) of each hazard event</span>
<span class="sd">        event_name (list): name of each hazard event</span>
<span class="sd">        date (np.array): date of events</span>
<span class="sd">        coord_exp (np.ndarray): exposures coordinates [lat, lon] (in degrees)</span>
<span class="sd">        eai_exp (np.array): expected annual impact for each exposure</span>
<span class="sd">        at_event (np.array): impact for each hazard event</span>
<span class="sd">        frequency (np.arrray): annual frequency of event</span>
<span class="sd">        tot_value (float): total exposure value affected</span>
<span class="sd">        aai_agg (float): average annual impact (aggregated)</span>
<span class="sd">        unit (str): value unit used (given by exposures unit)</span>
<span class="sd">        imp_mat (sparse.csr_matrix): matrix num_events x num_exp with impacts.</span>
<span class="sd">            only filled if save_mat is True in calc()</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Impact.__init__"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Empty initialization.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">([],</span> <span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">DEF_CRS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_event</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aai_agg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imp_mat</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Impact.calc_freq_curve"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.calc_freq_curve">[docs]</a>    <span class="k">def</span> <span class="nf">calc_freq_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">return_per</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute impact exceedance frequency curve.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            return_per (np.array, optional): return periods where to compute</span>
<span class="sd">                the exceedance impact. Use impact&#39;s frequencies if not provided</span>

<span class="sd">        Returns:</span>
<span class="sd">            ImpactFreqCurve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ifc</span> <span class="o">=</span> <span class="n">ImpactFreqCurve</span><span class="p">()</span>
        <span class="n">ifc</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span>
        <span class="c1"># Sort descendingly the impacts per events</span>
        <span class="n">sort_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">at_event</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Calculate exceedence frequency</span>
        <span class="n">exceed_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="n">sort_idxs</span><span class="p">])</span>
        <span class="c1"># Set return period and imact exceeding frequency</span>
        <span class="n">ifc</span><span class="o">.</span><span class="n">return_per</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">exceed_freq</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ifc</span><span class="o">.</span><span class="n">impact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">at_event</span><span class="p">[</span><span class="n">sort_idxs</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ifc</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">ifc</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Exceedance frequency curve&#39;</span>

        <span class="k">if</span> <span class="n">return_per</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">interp_imp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">return_per</span><span class="p">,</span> <span class="n">ifc</span><span class="o">.</span><span class="n">return_per</span><span class="p">,</span> <span class="n">ifc</span><span class="o">.</span><span class="n">impact</span><span class="p">)</span>
            <span class="n">ifc</span><span class="o">.</span><span class="n">return_per</span> <span class="o">=</span> <span class="n">return_per</span>
            <span class="n">ifc</span><span class="o">.</span><span class="n">impact</span> <span class="o">=</span> <span class="n">interp_imp</span>

        <span class="k">return</span> <span class="n">ifc</span></div>

<div class="viewcode-block" id="Impact.calc"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.calc">[docs]</a>    <span class="k">def</span> <span class="nf">calc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exposures</span><span class="p">,</span> <span class="n">impact_funcs</span><span class="p">,</span> <span class="n">hazard</span><span class="p">,</span> <span class="n">save_mat</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute impact of an hazard to exposures.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            exposures (Exposures): exposures</span>
<span class="sd">            impact_funcs (ImpactFuncSet): impact functions</span>
<span class="sd">            hazard (Hazard): hazard</span>
<span class="sd">            self_mat (bool): self impact matrix: events x exposures</span>

<span class="sd">        Examples:</span>
<span class="sd">            Use Entity class:</span>

<span class="sd">            &gt;&gt;&gt; haz = Hazard(&#39;TC&#39;) # Set hazard</span>
<span class="sd">            &gt;&gt;&gt; haz.read_mat(HAZ_DEMO_MAT)</span>
<span class="sd">            &gt;&gt;&gt; haz.check()</span>
<span class="sd">            &gt;&gt;&gt; ent = Entity() # Load entity with default values</span>
<span class="sd">            &gt;&gt;&gt; ent.read_excel(ENT_TEMPLATE_XLS) # Set exposures</span>
<span class="sd">            &gt;&gt;&gt; ent.check()</span>
<span class="sd">            &gt;&gt;&gt; imp = Impact()</span>
<span class="sd">            &gt;&gt;&gt; imp.calc(ent.exposures, ent.impact_funcs, haz)</span>
<span class="sd">            &gt;&gt;&gt; imp.calc_freq_curve().plot()</span>

<span class="sd">            Specify only exposures and impact functions:</span>

<span class="sd">            &gt;&gt;&gt; haz = Hazard(&#39;TC&#39;) # Set hazard</span>
<span class="sd">            &gt;&gt;&gt; haz.read_mat(HAZ_DEMO_MAT)</span>
<span class="sd">            &gt;&gt;&gt; haz.check()</span>
<span class="sd">            &gt;&gt;&gt; funcs = ImpactFuncSet()</span>
<span class="sd">            &gt;&gt;&gt; funcs.read_excel(ENT_TEMPLATE_XLS) # Set impact functions</span>
<span class="sd">            &gt;&gt;&gt; funcs.check()</span>
<span class="sd">            &gt;&gt;&gt; exp = Exposures(pd.read_excel(ENT_TEMPLATE_XLS)) # Set exposures</span>
<span class="sd">            &gt;&gt;&gt; exp.check()</span>
<span class="sd">            &gt;&gt;&gt; imp = Impact()</span>
<span class="sd">            &gt;&gt;&gt; imp.calc(exp, funcs, haz)</span>
<span class="sd">            &gt;&gt;&gt; imp.aai_agg</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. Assign centroids to each exposure if not done</span>
        <span class="n">assign_haz</span> <span class="o">=</span> <span class="n">INDICATOR_CENTR</span> <span class="o">+</span> <span class="n">hazard</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">haz_type</span>
        <span class="k">if</span> <span class="n">assign_haz</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exposures</span><span class="p">:</span>
            <span class="n">exposures</span><span class="o">.</span><span class="n">assign_centroids</span><span class="p">(</span><span class="n">hazard</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Exposures matching centroids found in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">assign_haz</span><span class="p">)</span>

        <span class="c1"># 2. Initialize values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">exposures</span><span class="o">.</span><span class="n">value_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">event_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_name</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">event_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">exposures</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                   <span class="n">exposures</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">values</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_event</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">hazard</span><span class="o">.</span><span class="n">intensity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">exposures</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;exp&#39;</span><span class="p">:</span> <span class="n">exposures</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="s1">&#39;if_set&#39;</span><span class="p">:</span> <span class="n">impact_funcs</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
                    <span class="s1">&#39;haz&#39;</span><span class="p">:</span> <span class="n">hazard</span><span class="o">.</span><span class="n">tag</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">exposures</span><span class="o">.</span><span class="n">crs</span>

        <span class="c1"># Select exposures with positive value and assigned centroid</span>
        <span class="n">exp_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">exposures</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> \
                           <span class="n">exposures</span><span class="p">[</span><span class="n">assign_haz</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">exp_idx</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No affected exposures.&quot;</span><span class="p">)</span>

        <span class="n">num_events</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">intensity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Calculating damage for </span><span class="si">%s</span><span class="s1"> assets (&gt;0) and </span><span class="si">%s</span><span class="s1"> events.&#39;</span><span class="p">,</span>
                    <span class="n">exp_idx</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">num_events</span><span class="p">)</span>

        <span class="c1"># Get damage functions for this hazard</span>
        <span class="n">if_haz</span> <span class="o">=</span> <span class="n">INDICATOR_IF</span> <span class="o">+</span> <span class="n">hazard</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">haz_type</span>
        <span class="n">haz_imp</span> <span class="o">=</span> <span class="n">impact_funcs</span><span class="o">.</span><span class="n">get_func</span><span class="p">(</span><span class="n">hazard</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">haz_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">if_haz</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exposures</span> <span class="ow">and</span> <span class="n">INDICATOR_IF</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exposures</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Missing exposures impact functions </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">INDICATOR_IF</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">if</span> <span class="n">if_haz</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exposures</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Missing exposures impact functions for hazard </span><span class="si">%s</span><span class="s1">. &#39;</span> <span class="o">+</span>\
                        <span class="s1">&#39;Using impact functions in </span><span class="si">%s</span><span class="s1">.&#39;</span><span class="p">,</span> <span class="n">if_haz</span><span class="p">,</span> <span class="n">INDICATOR_IF</span><span class="p">)</span>
            <span class="n">if_haz</span> <span class="o">=</span> <span class="n">INDICATOR_IF</span>

        <span class="c1"># Check if deductible and cover should be applied</span>
        <span class="n">insure_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;deductible&#39;</span> <span class="ow">in</span> <span class="n">exposures</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;cover&#39;</span> <span class="ow">in</span> <span class="n">exposures</span><span class="p">)</span> \
        <span class="ow">and</span> <span class="n">exposures</span><span class="o">.</span><span class="n">cover</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
            <span class="n">insure_flag</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">save_mat</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_mat</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">lil_matrix</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">exposures</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

        <span class="c1"># 3. Loop over exposures according to their impact function</span>
        <span class="n">tot_exp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">imp_fun</span> <span class="ow">in</span> <span class="n">haz_imp</span><span class="p">:</span>
            <span class="c1"># get indices of all the exposures with this impact function</span>
            <span class="n">exp_iimp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">exposures</span><span class="p">[</span><span class="n">if_haz</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">exp_idx</span><span class="p">]</span> <span class="o">==</span> <span class="n">imp_fun</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tot_exp</span> <span class="o">+=</span> <span class="n">exp_iimp</span><span class="o">.</span><span class="n">size</span>
            <span class="n">exp_step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">CONFIG</span><span class="p">[</span><span class="s1">&#39;global&#39;</span><span class="p">][</span><span class="s1">&#39;max_matrix_size&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">num_events</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">exp_step</span><span class="p">:</span>
                <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Increase max_matrix_size configuration parameter&#39;</span>
                             <span class="s1">&#39; to &gt; </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_events</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="c1"># separte in chunks</span>
            <span class="n">chk</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">chk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">exp_iimp</span><span class="o">.</span><span class="n">size</span><span class="o">/</span><span class="n">exp_step</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_exp_impact</span><span class="p">(</span> \
                    <span class="n">exp_idx</span><span class="p">[</span><span class="n">exp_iimp</span><span class="p">[</span><span class="n">chk</span><span class="o">*</span><span class="n">exp_step</span><span class="p">:(</span><span class="n">chk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">exp_step</span><span class="p">]],</span>\
                    <span class="n">exposures</span><span class="p">,</span> <span class="n">hazard</span><span class="p">,</span> <span class="n">imp_fun</span><span class="p">,</span> <span class="n">insure_flag</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_exp_impact</span><span class="p">(</span><span class="n">exp_idx</span><span class="p">[</span><span class="n">exp_iimp</span><span class="p">[(</span><span class="n">chk</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">exp_step</span><span class="p">:]],</span>\
                <span class="n">exposures</span><span class="p">,</span> <span class="n">hazard</span><span class="p">,</span> <span class="n">imp_fun</span><span class="p">,</span> <span class="n">insure_flag</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">tot_exp</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No impact functions match the exposures.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aai_agg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">at_event</span> <span class="o">*</span> <span class="n">hazard</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save_mat</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">imp_mat</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span></div>

<div class="viewcode-block" id="Impact.plot_hexbin_eai_exposure"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.plot_hexbin_eai_exposure">[docs]</a>    <span class="k">def</span> <span class="nf">plot_hexbin_eai_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="n">pop_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;neither&#39;</span><span class="p">,</span>
                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot hexbin expected annual impact of each exposure.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            mask (np.array, optional): mask to apply to eai_exp plotted.</span>
<span class="sd">            ignore_zero (bool, optional): flag to indicate if zero and negative</span>
<span class="sd">                values are ignored in plot. Default: False</span>
<span class="sd">            pop_name (bool, optional): add names of the populated places</span>
<span class="sd">            buffer (float, optional): border to add to coordinates.</span>
<span class="sd">                Default: 1.0.</span>
<span class="sd">            extend (str, optional): extend border colorbar with arrows.</span>
<span class="sd">                [ &#39;neither&#39; | &#39;both&#39; | &#39;min&#39; | &#39;max&#39; ]</span>
<span class="sd">            kwargs (optional): arguments for hexbin matplotlib function</span>

<span class="sd">         Returns:</span>
<span class="sd">            matplotlib.figure.Figure, cartopy.mpl.geoaxes.GeoAxesSubplot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eai_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_exp</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">eai_exp</span><span class="o">.</span><span class="n">plot_hexbin</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">ignore_zero</span><span class="p">,</span> <span class="n">pop_name</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span>
                                        <span class="n">extend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Expected annual impact&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="Impact.plot_scatter_eai_exposure"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.plot_scatter_eai_exposure">[docs]</a>    <span class="k">def</span> <span class="nf">plot_scatter_eai_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">pop_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;neither&#39;</span><span class="p">,</span>
                                  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot scatter expected annual impact of each exposure.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            mask (np.array, optional): mask to apply to eai_exp plotted.</span>
<span class="sd">            ignore_zero (bool, optional): flag to indicate if zero and negative</span>
<span class="sd">                values are ignored in plot. Default: False</span>
<span class="sd">            pop_name (bool, optional): add names of the populated places</span>
<span class="sd">            buffer (float, optional): border to add to coordinates.</span>
<span class="sd">                Default: 1.0.</span>
<span class="sd">            extend (str, optional): extend border colorbar with arrows.</span>
<span class="sd">                [ &#39;neither&#39; | &#39;both&#39; | &#39;min&#39; | &#39;max&#39; ]</span>
<span class="sd">            kwargs (optional): arguments for hexbin matplotlib function</span>

<span class="sd">         Returns:</span>
<span class="sd">            matplotlib.figure.Figure, cartopy.mpl.geoaxes.GeoAxesSubplot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eai_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_exp</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">eai_exp</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">ignore_zero</span><span class="p">,</span> <span class="n">pop_name</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span>
                                         <span class="n">extend</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Expected annual impact&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="Impact.plot_raster_eai_exposure"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.plot_raster_eai_exposure">[docs]</a>    <span class="k">def</span> <span class="nf">plot_raster_eai_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raster_res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_tiff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">raster_f</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))),</span>
                                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;value (log10)&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot raster expected annual impact of each exposure.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            res (float, optional): resolution of current data in units of latitude</span>
<span class="sd">                and longitude, approximated if not provided.</span>
<span class="sd">            raster_res (float, optional): desired resolution of the raster</span>
<span class="sd">            save_tiff (str, optional): file name to save the raster in tiff</span>
<span class="sd">                format, if provided</span>
<span class="sd">            raster_f (lambda function): transformation to use to data. Default:</span>
<span class="sd">                log10 adding 1.</span>
<span class="sd">            label (str): colorbar label</span>
<span class="sd">            kwargs (optional): arguments for imshow matplotlib function</span>

<span class="sd">         Returns:</span>
<span class="sd">            matplotlib.figure.Figure, cartopy.mpl.geoaxes.GeoAxesSubplot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eai_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_exp</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">eai_exp</span><span class="o">.</span><span class="n">plot_raster</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">raster_res</span><span class="p">,</span> <span class="n">save_tiff</span><span class="p">,</span> <span class="n">raster_f</span><span class="p">,</span>
                                        <span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Expected annual impact&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="Impact.plot_basemap_eai_exposure"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.plot_basemap_eai_exposure">[docs]</a>    <span class="k">def</span> <span class="nf">plot_basemap_eai_exposure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_zero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pop_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">buffer</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;neither&#39;</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                  <span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://tile.stamen.com/terrain/tileZ/tileX/tileY.png&#39;</span><span class="p">,</span>
                                  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot basemap expected annual impact of each exposure.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            mask (np.array, optional): mask to apply to eai_exp plotted.</span>
<span class="sd">            ignore_zero (bool, optional): flag to indicate if zero and negative</span>
<span class="sd">                values are ignored in plot. Default: False</span>
<span class="sd">            pop_name (bool, optional): add names of the populated places</span>
<span class="sd">            buffer (float, optional): border to add to coordinates. Default: 0.0.</span>
<span class="sd">            extend (str, optional): extend border colorbar with arrows.</span>
<span class="sd">                [ &#39;neither&#39; | &#39;both&#39; | &#39;min&#39; | &#39;max&#39; ]</span>
<span class="sd">            zoom (int, optional): zoom coefficient used in the satellite image</span>
<span class="sd">            url (str, optional): image source, e.g. ctx.sources.OSM_C</span>
<span class="sd">            kwargs (optional): arguments for scatter matplotlib function, e.g.</span>
<span class="sd">                cmap=&#39;Greys&#39;. Default: &#39;Wistia&#39;</span>

<span class="sd">         Returns:</span>
<span class="sd">            matplotlib.figure.Figure, cartopy.mpl.geoaxes.GeoAxesSubplot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eai_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_exp</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">eai_exp</span><span class="o">.</span><span class="n">plot_basemap</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">ignore_zero</span><span class="p">,</span> <span class="n">pop_name</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span>
                                         <span class="n">extend</span><span class="p">,</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Expected annual impact&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="Impact.write_csv"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.write_csv">[docs]</a>    <span class="k">def</span> <span class="nf">write_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Write data into csv file. imp_mat is not saved.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str): absolute path of the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">imp_file</span><span class="p">:</span>
            <span class="n">imp_wr</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">imp_file</span><span class="p">)</span>
            <span class="n">imp_wr</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&quot;tag_hazard&quot;</span><span class="p">,</span> <span class="s2">&quot;tag_exposure&quot;</span><span class="p">,</span> <span class="s2">&quot;tag_impact_func&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="s2">&quot;tot_value&quot;</span><span class="p">,</span> <span class="s2">&quot;aai_agg&quot;</span><span class="p">,</span> <span class="s2">&quot;event_id&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;event_name&quot;</span><span class="p">,</span> <span class="s2">&quot;event_date&quot;</span><span class="p">,</span> <span class="s2">&quot;event_frequency&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;at_event&quot;</span><span class="p">,</span> <span class="s2">&quot;eai_exp&quot;</span><span class="p">,</span> <span class="s2">&quot;exp_lat&quot;</span><span class="p">,</span> <span class="s2">&quot;exp_lon&quot;</span><span class="p">,</span> <span class="s2">&quot;exp_crs&quot;</span><span class="p">])</span>
            <span class="n">csv_data</span> <span class="o">=</span> <span class="p">[[[</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">haz_type</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">file_name</span><span class="p">],</span>
                         <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">description</span><span class="p">]],</span>
                        <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">file_name</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">description</span><span class="p">]],</span>
                        <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;if_set&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">file_name</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;if_set&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">description</span><span class="p">]],</span>
                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tot_value</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">aai_agg</span><span class="p">],</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">event_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">at_event</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)]]</span>
            <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">zip_longest</span><span class="p">(</span><span class="o">*</span><span class="n">csv_data</span><span class="p">):</span>
                <span class="n">imp_wr</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></div>

<div class="viewcode-block" id="Impact.write_excel"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.write_excel">[docs]</a>    <span class="k">def</span> <span class="nf">write_excel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Write data into Excel file. imp_mat is not saved.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str): absolute path of the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">write_col</span><span class="p">(</span><span class="n">i_col</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="n">xls_data</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot; Write one measure &quot;&quot;&quot;</span>
            <span class="n">row_ini</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">dat_row</span> <span class="ow">in</span> <span class="n">xls_data</span><span class="p">:</span>
                <span class="n">imp_ws</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row_ini</span><span class="p">,</span> <span class="n">i_col</span><span class="p">,</span> <span class="n">dat_row</span><span class="p">)</span>
                <span class="n">row_ini</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">imp_wb</span> <span class="o">=</span> <span class="n">xlsxwriter</span><span class="o">.</span><span class="n">Workbook</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="n">imp_ws</span> <span class="o">=</span> <span class="n">imp_wb</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">()</span>

        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tag_hazard&quot;</span><span class="p">,</span> <span class="s2">&quot;tag_exposure&quot;</span><span class="p">,</span> <span class="s2">&quot;tag_impact_func&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;unit&quot;</span><span class="p">,</span> <span class="s2">&quot;tot_value&quot;</span><span class="p">,</span> <span class="s2">&quot;aai_agg&quot;</span><span class="p">,</span> <span class="s2">&quot;event_id&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;event_name&quot;</span><span class="p">,</span> <span class="s2">&quot;event_date&quot;</span><span class="p">,</span> <span class="s2">&quot;event_frequency&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;at_event&quot;</span><span class="p">,</span> <span class="s2">&quot;eai_exp&quot;</span><span class="p">,</span> <span class="s2">&quot;exp_lat&quot;</span><span class="p">,</span> <span class="s2">&quot;exp_lon&quot;</span><span class="p">,</span> <span class="s2">&quot;exp_crs&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">icol</span><span class="p">,</span> <span class="n">head_dat</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">header</span><span class="p">):</span>
            <span class="n">imp_ws</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">icol</span><span class="p">,</span> <span class="n">head_dat</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">haz_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">file_name</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">description</span><span class="p">)]</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">file_name</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">description</span><span class="p">)]</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;if_set&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">file_name</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;if_set&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">description</span><span class="p">)]</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">])</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tot_value</span><span class="p">])</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">aai_agg</span><span class="p">])</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_id</span><span class="p">)</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_name</span><span class="p">)</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">)</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">at_event</span><span class="p">)</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span><span class="p">)</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">write_col</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="n">imp_ws</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crs</span><span class="p">)])</span>

        <span class="n">imp_wb</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="Impact.write_sparse_csr"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.write_sparse_csr">[docs]</a>    <span class="k">def</span> <span class="nf">write_sparse_csr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Write imp_mat matrix in numpy&#39;s npz format.&quot;&quot;&quot;</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imp_mat</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imp_mat</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span>
                 <span class="n">indptr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imp_mat</span><span class="o">.</span><span class="n">indptr</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">imp_mat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Impact.calc_impact_year_set"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.calc_impact_year_set">[docs]</a>    <span class="k">def</span> <span class="nf">calc_impact_year_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_years</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculate yearly impact from impact data.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            all_years (boolean): return values for all years between first and</span>
<span class="sd">            last year with event, including years without any events.</span>
<span class="sd">    </span>
<span class="sd">        Returns:</span>
<span class="sd">             Impact year set of type numpy.ndarray with summed impact per year.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">orig_year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromordinal</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
                      <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">date</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">all_years</span><span class="p">:</span>
            <span class="n">years</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">orig_year</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">orig_year</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">years</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">orig_year</span><span class="p">)))</span>
        <span class="n">year_set</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
            <span class="n">year_set</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">at_event</span><span class="p">[</span><span class="n">orig_year</span><span class="o">==</span><span class="n">year</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">year_set</span></div>

<div class="viewcode-block" id="Impact.read_sparse_csr"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.read_sparse_csr">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">read_sparse_csr</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read imp_mat matrix from numpy&#39;s npz format.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str): file name</span>

<span class="sd">        Returns:</span>
<span class="sd">            sparse.csr_matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">loader</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">loader</span><span class="p">[</span><span class="s1">&#39;indices&#39;</span><span class="p">],</span> <span class="n">loader</span><span class="p">[</span><span class="s1">&#39;indptr&#39;</span><span class="p">]),</span>
                                 <span class="n">shape</span><span class="o">=</span><span class="n">loader</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Impact.read_csv"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.read_csv">[docs]</a>    <span class="k">def</span> <span class="nf">read_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read csv file containing impact data generated by write_csv.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str): absolute path of the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot_value</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">tot_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aai_agg</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">aai_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">event_id</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">imp_df</span><span class="o">.</span><span class="n">event_id</span><span class="p">)]</span>
        <span class="n">num_ev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_id</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_name</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">event_name</span><span class="p">[:</span><span class="n">num_ev</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">event_date</span><span class="p">[:</span><span class="n">num_ev</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_event</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">at_event</span><span class="p">[:</span><span class="n">num_ev</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">event_frequency</span><span class="p">[:</span><span class="n">num_ev</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">eai_exp</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">imp_df</span><span class="o">.</span><span class="n">eai_exp</span><span class="p">)]</span>
        <span class="n">num_exp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_exp</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">exp_lat</span><span class="p">[:</span><span class="n">num_exp</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">imp_df</span><span class="o">.</span><span class="n">exp_lon</span><span class="p">[:</span><span class="n">num_exp</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">imp_df</span><span class="o">.</span><span class="n">exp_crs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TagHaz</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">imp_df</span><span class="o">.</span><span class="n">tag_hazard</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                 <span class="nb">str</span><span class="p">(</span><span class="n">imp_df</span><span class="o">.</span><span class="n">tag_hazard</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                 <span class="nb">str</span><span class="p">(</span><span class="n">imp_df</span><span class="o">.</span><span class="n">tag_hazard</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">imp_df</span><span class="o">.</span><span class="n">tag_exposure</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">imp_df</span><span class="o">.</span><span class="n">tag_exposure</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;if_set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">imp_df</span><span class="o">.</span><span class="n">tag_impact_func</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                 <span class="nb">str</span><span class="p">(</span><span class="n">imp_df</span><span class="o">.</span><span class="n">tag_impact_func</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Impact.read_excel"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.Impact.read_excel">[docs]</a>    <span class="k">def</span> <span class="nf">read_excel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Read excel file containing impact data generated by write_excel.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            file_name (str): absolute path of the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dfr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TagHaz</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">haz_type</span> <span class="o">=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;tag_hazard&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;tag_hazard&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;haz&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;tag_hazard&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;tag_exposure&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;tag_exposure&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;if_set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;if_set&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">file_name</span> <span class="o">=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;tag_impact_func&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">[</span><span class="s1">&#39;if_set&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">dfr</span><span class="p">[</span><span class="s1">&#39;tag_impact_func&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot_value</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">tot_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aai_agg</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">aai_agg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event_id</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">event_id</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">event_id</span><span class="o">.</span><span class="n">values</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_name</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">event_name</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">event_id</span><span class="o">.</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">event_date</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">event_id</span><span class="o">.</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">event_frequency</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">event_id</span><span class="o">.</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_event</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">at_event</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">event_id</span><span class="o">.</span><span class="n">size</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">eai_exp</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">eai_exp</span><span class="o">.</span><span class="n">values</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">exp_lat</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfr</span><span class="o">.</span><span class="n">exp_lon</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">dfr</span><span class="o">.</span><span class="n">exp_crs</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">_exp_impact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exp_iimp</span><span class="p">,</span> <span class="n">exposures</span><span class="p">,</span> <span class="n">hazard</span><span class="p">,</span> <span class="n">imp_fun</span><span class="p">,</span> <span class="n">insure_flag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute impact for inpute exposure indexes and impact function.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            exp_iimp (np.array): exposures indexes</span>
<span class="sd">            exposures (Exposures): exposures instance</span>
<span class="sd">            hazard (Hazard): hazard instance</span>
<span class="sd">            imp_fun (ImpactFunc): impact function instance</span>
<span class="sd">            insure_flag (bool): consider deductible and cover of exposures</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exp_iimp</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># get assigned centroids</span>
        <span class="n">icens</span> <span class="o">=</span> <span class="n">exposures</span><span class="p">[</span><span class="n">INDICATOR_CENTR</span> <span class="o">+</span> <span class="n">hazard</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">haz_type</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">exp_iimp</span><span class="p">]</span>

        <span class="c1"># get affected intensities</span>
        <span class="n">inten_val</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">intensity</span><span class="p">[:,</span> <span class="n">icens</span><span class="p">]</span>
        <span class="c1"># get affected fractions</span>
        <span class="n">fract</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">fraction</span><span class="p">[:,</span> <span class="n">icens</span><span class="p">]</span>
        <span class="c1"># impact = fraction * mdr * value</span>
        <span class="n">inten_val</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">imp_fun</span><span class="o">.</span><span class="n">calc_mdr</span><span class="p">(</span><span class="n">inten_val</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">impact</span> <span class="o">=</span> <span class="n">fract</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">inten_val</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">exposures</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">exp_iimp</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">insure_flag</span> <span class="ow">and</span> <span class="n">impact</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">inten_val</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">intensity</span><span class="p">[:,</span> <span class="n">icens</span><span class="p">]</span><span class="o">.</span><span class="n">todense</span><span class="p">()</span>
            <span class="n">paa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">inten_val</span><span class="p">,</span> <span class="n">imp_fun</span><span class="o">.</span><span class="n">intensity</span><span class="p">,</span> <span class="n">imp_fun</span><span class="o">.</span><span class="n">paa</span><span class="p">)</span>
            <span class="n">impact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">impact</span> <span class="o">-</span> \
                <span class="n">exposures</span><span class="o">.</span><span class="n">deductible</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">exp_iimp</span><span class="p">]</span> <span class="o">*</span> <span class="n">paa</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> \
                <span class="n">exposures</span><span class="o">.</span><span class="n">cover</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">exp_iimp</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span><span class="p">[</span><span class="n">exp_iimp</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">impact</span><span class="p">)</span> <span class="o">*</span> \
                <span class="n">hazard</span><span class="o">.</span><span class="n">frequency</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span><span class="p">[</span><span class="n">exp_iimp</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> \
                <span class="n">impact</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">hazard</span><span class="o">.</span><span class="n">frequency</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">at_event</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">impact</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tot_value</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">exposures</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">exp_iimp</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imp_mat</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imp_mat</span><span class="p">[:,</span> <span class="n">exp_iimp</span><span class="p">]</span> <span class="o">=</span> <span class="n">impact</span>

    <span class="k">def</span> <span class="nf">_build_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">eai_exp</span> <span class="o">=</span> <span class="n">Exposures</span><span class="p">()</span>
        <span class="n">eai_exp</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eai_exp</span>
        <span class="n">eai_exp</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">eai_exp</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_exp</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">eai_exp</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs</span>
        <span class="n">eai_exp</span><span class="o">.</span><span class="n">value_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">eai_exp</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">eai_exp</span></div>

<div class="viewcode-block" id="ImpactFreqCurve"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.ImpactFreqCurve">[docs]</a><span class="k">class</span> <span class="nc">ImpactFreqCurve</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Impact exceedence frequency curve.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        tag (dict): dictionary of tags of exposures, impact functions set and</span>
<span class="sd">            hazard: {&#39;exp&#39;: Tag(), &#39;if_set&#39;: Tag(), &#39;haz&#39;: TagHazard()}</span>
<span class="sd">        return_per (np.array): return period</span>
<span class="sd">        impact (np.array): impact exceeding frequency</span>
<span class="sd">        unit (str): value unit used (given by exposures unit)</span>
<span class="sd">        label (str): string describing source data</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="ImpactFreqCurve.__init__"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.ImpactFreqCurve.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_per</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impact</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></div>

<div class="viewcode-block" id="ImpactFreqCurve.plot"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.ImpactFreqCurve.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot impact frequency curve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.figure.Figure, [matplotlib.axes._subplots.AxesSubplot]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">u_plot</span><span class="o">.</span><span class="n">Graph2D</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="s1">&#39;Return period (year)&#39;</span><span class="p">,</span> <span class="s1">&#39;Impact (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_per</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">impact</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_elems</span><span class="p">()</span></div>

<div class="viewcode-block" id="ImpactFreqCurve.plot_compare"><a class="viewcode-back" href="../../../climada/climada.engine.html#climada.engine.impact.ImpactFreqCurve.plot_compare">[docs]</a>    <span class="k">def</span> <span class="nf">plot_compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ifc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plot current and input impact frequency curves in a figure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            matplotlib.figure.Figure, [matplotlib.axes._subplots.AxesSubplot]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">!=</span> <span class="n">ifc</span><span class="o">.</span><span class="n">unit</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Comparing between two different units: </span><span class="si">%s</span><span class="s2"> and </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>\
                         <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">ifc</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">u_plot</span><span class="o">.</span><span class="n">Graph2D</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="s1">&#39;Return period (year)&#39;</span><span class="p">,</span> <span class="s1">&#39;Impact (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">return_per</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">impact</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">add_curve</span><span class="p">(</span><span class="n">ifc</span><span class="o">.</span><span class="n">return_per</span><span class="p">,</span> <span class="n">ifc</span><span class="o">.</span><span class="n">impact</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ifc</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">graph</span><span class="o">.</span><span class="n">get_elems</span><span class="p">()</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, ETH Zurich.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>