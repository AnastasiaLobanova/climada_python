
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Exposures class &#8212; climada 1.2.4-dev documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html"><h1 style="font-size: 3em;">climada</h1></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Exposures class</a><ul>
<li><a class="reference internal" href="#&nbsp;Define-Exposures-from-a-DataFrame">&nbsp;Define Exposures from a DataFrame</a></li>
<li><a class="reference internal" href="#&nbsp;Define-Exposures-from-a-GeoDataFrame-with-POINT-geometry">&nbsp;Define Exposures from a GeoDataFrame with POINT geometry</a></li>
<li><a class="reference internal" href="#&nbsp;Read-Exposures-of-an-excel-file">&nbsp;Read Exposures of an excel file</a></li>
<li><a class="reference internal" href="#Read-Exposures-of-any-file-type-supported-by-GeoDataFrame-and-DataFrame">Read Exposures of any file type supported by GeoDataFrame and DataFrame</a></li>
<li><a class="reference internal" href="#&nbsp;Read-exposures-generated-by-CLIMADA">&nbsp;Read exposures generated by CLIMADA</a></li>
<li><a class="reference internal" href="#Methods">Methods</a><ul>
<li><a class="reference internal" href="#all-the-methods-from-GeoDataFrame">all the methods from GeoDataFrame</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Visualize-Exposures">Visualize Exposures</a></li>
<li><a class="reference internal" href="#Write-Exposures">Write Exposures</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorial/climada_entity_Exposures.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Exposures-class">
<h1>Exposures class<a class="headerlink" href="#Exposures-class" title="Permalink to this headline">¶</a></h1>
<p>Exposure can describe the geographical distribution of people, livelihoods and assets or infrastructure; all items potentially exposed to hazards. It is represented in the class <code class="docutils literal notranslate"><span class="pre">Exposures</span></code>, which is a <a class="reference external" href="https://geopandas.readthedocs.io/en/latest/data_structures.html#geodataframe">GeoDataFrame</a> of Python’s library <a class="reference external" href="https://geopandas.readthedocs.io/en/latest/gallery/cartopy_convert.html">geopandas</a>.</p>
<p>The variables (columns) and metada contained are:</p>
<ul class="simple">
<li>tag (Tag): metada - information about the source data</li>
<li>ref_year (int): metada - reference year</li>
<li>value_unit (str): metada - unit of the exposures values</li>
<li><strong>latitude</strong> (pd.Series): latitude</li>
<li><strong>longitude</strong> (pd.Series): longitude</li>
<li><strong>value</strong> (pd.Series): a value for each exposure</li>
<li>if_ (pd.Series, optional): e.g. if_TC. impact functions ids for hazard TC. There might be different hazards defined: if_TC, if_FL, … If not provided, set to default <code class="docutils literal notranslate"><span class="pre">if_</span></code> with ids 1 in check().</li>
<li>geometry (pd.Series, optional): geometry of type Point of each instance. Computed in method <code class="docutils literal notranslate"><span class="pre">set_geometry_points()</span></code></li>
<li>deductible (pd.Series, optional): deductible value for each exposure. Used for insurance</li>
<li>cover (pd.Series, optional): cover value for each exposure. Used for insurance</li>
<li>category_id (pd.Series, optional): category id (e.g. building code) for each exposure</li>
<li>region_id (pd.Series, optional): region id (e.g. country ISO code) for each exposure</li>
<li>centr_* (pd.Series, optional): e.g. centr_TC. centroids index for hazard TC. There might be different hazards defined: centr_TC, centr_FL, … Computed in method <code class="docutils literal notranslate"><span class="pre">assign_centroids()</span></code></li>
</ul>
<p>Some of the variables are <em>optional</em>. This means that the package <code class="docutils literal notranslate"><span class="pre">climada.engine</span></code> also works without these variables set. For instance, the <code class="docutils literal notranslate"><span class="pre">region_id</span></code> and <code class="docutils literal notranslate"><span class="pre">category_id</span></code> values only provide additional information, whilst the <code class="docutils literal notranslate"><span class="pre">centr_*</span></code> variable can be computed if not provided using the method <code class="docutils literal notranslate"><span class="pre">assign_centroids()</span></code>. The attibute <code class="docutils literal notranslate"><span class="pre">geometry</span></code> is only needed to execute the methods of <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> and can be set using the method <code class="docutils literal notranslate"><span class="pre">set_geometry_points()</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">if_</span></code> is the most important attribute, since it relates the exposures to the hazard by specifying the impact functions. Ideally it should be set to the specific hazard (e.g. <code class="docutils literal notranslate"><span class="pre">if_TC</span></code>) so that different hazards can be set in the same Exposures (e.g. <code class="docutils literal notranslate"><span class="pre">if_TC</span></code> and <code class="docutils literal notranslate"><span class="pre">if_FL</span></code>). If there isn’t any <code class="docutils literal notranslate"><span class="pre">if_*</span></code> value provided, the <code class="docutils literal notranslate"><span class="pre">check()</span></code> method puts a default <code class="docutils literal notranslate"><span class="pre">if_</span></code> with ones which can be used by the impact calculation in <code class="docutils literal notranslate"><span class="pre">engine</span></code>.</p>
<p>After defining an <code class="docutils literal notranslate"><span class="pre">Exposures</span></code> instance use always the <code class="docutils literal notranslate"><span class="pre">check()</span></code> method to see which attributes are missing. This method will raise an ERROR if <code class="docutils literal notranslate"><span class="pre">value</span></code>, <code class="docutils literal notranslate"><span class="pre">longitude</span></code> or <code class="docutils literal notranslate"><span class="pre">latitude</span></code> ar missing and an INFO messages for the the optional variables not set.</p>
<div class="section" id="&nbsp;Define-Exposures-from-a-DataFrame">
<h2>&nbsp;Define Exposures from a DataFrame<a class="headerlink" href="# Define-Exposures-from-a-DataFrame" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">from</span> <span class="nn">climada.entity</span> <span class="kn">import</span> <span class="n">Exposures</span>

<span class="c1"># Fill DataFrame</span>
<span class="n">exp_df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">()</span>
<span class="n">n_exp</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="mi">100</span>
<span class="n">exp_df</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_exp</span><span class="p">)</span> <span class="c1"># provide value</span>
<span class="n">lat</span><span class="p">,</span> <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">15</span> <span class="p">:</span> <span class="mi">35</span> <span class="p">:</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_exp</span><span class="p">)),</span> <span class="mi">20</span> <span class="p">:</span> <span class="mi">40</span> <span class="p">:</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n_exp</span><span class="p">))]</span>
<span class="n">exp_df</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1"># provide latitude</span>
<span class="n">exp_df</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="c1"># provide longitude</span>
<span class="n">exp_df</span><span class="p">[</span><span class="s1">&#39;if_TC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_exp</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="c1"># provide impact functions for TC or any other peril</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;exp_df is a DataFrame:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exp_df</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;exp_df looks like:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">exp_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Generate Exposures</span>
<span class="n">exp_df</span> <span class="o">=</span> <span class="n">Exposures</span><span class="p">(</span><span class="n">exp_df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;exp_df is now an Exposures:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exp_df</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="n">exp_df</span><span class="o">.</span><span class="n">set_geometry_points</span><span class="p">()</span> <span class="c1"># set geometry attribute (shapely Points) from GeoDataFrame from latitude and longitude</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;check method logs:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="n">exp_df</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="c1"># puts metadata that has not been assigned</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span>  <span class="o">+</span> <span class="s1">&#39;exp_df looks like:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">exp_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2019-03-29 18:54:46,381 - climada - DEBUG - Loading default config file: /Users/aznarsig/Documents/Python/climada_python/climada/conf/defaults.conf
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/aznarsig/anaconda3/envs/climada_env/lib/python3.6/site-packages/h5py/__init__.py:36: FutureWarning: Conversion of the second argument of issubdtype from `float` to `np.floating` is deprecated. In future, it will be treated as `np.float64 == np.dtype(float).type`.
  from ._conv import register_converters as _register_converters
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-black-intense-fg ansi-bold">exp_df is a DataFrame: &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</span>
<span class="ansi-black-intense-fg ansi-bold">exp_df looks like:</span>
   value  latitude  longitude  if_TC
0      0      15.0  20.000000      1
1      1      15.0  20.202020      1
2      2      15.0  20.404040      1
3      3      15.0  20.606061      1
4      4      15.0  20.808081      1

<span class="ansi-black-intense-fg ansi-bold">exp_df is now an Exposures: &lt;class &#39;climada.entity.exposures.base.Exposures&#39;&gt;</span>
2019-03-29 18:54:47,565 - climada.entity.exposures.base - INFO - Setting geometry attribute.

<span class="ansi-black-intense-fg ansi-bold">check method logs:</span>
2019-03-29 18:54:47,634 - climada.entity.exposures.base - INFO - crs set to default value: {&#39;init&#39;: &#39;epsg:4326&#39;}
2019-03-29 18:54:47,635 - climada.entity.exposures.base - INFO - tag metadata set to default value:  File:
 Description:
2019-03-29 18:54:47,636 - climada.entity.exposures.base - INFO - ref_year metadata set to default value: 2018
2019-03-29 18:54:47,636 - climada.entity.exposures.base - INFO - value_unit metadata set to default value: USD
2019-03-29 18:54:47,637 - climada.entity.exposures.base - INFO - centr_ not set.
2019-03-29 18:54:47,638 - climada.entity.exposures.base - INFO - deductible not set.
2019-03-29 18:54:47,639 - climada.entity.exposures.base - INFO - cover not set.
2019-03-29 18:54:47,639 - climada.entity.exposures.base - INFO - category_id not set.
2019-03-29 18:54:47,641 - climada.entity.exposures.base - INFO - region_id not set.

<span class="ansi-black-intense-fg ansi-bold">exp_df looks like:</span>
   value  latitude  longitude  if_TC                      geometry
0      0      15.0  20.000000      1                 POINT (20 15)
1      1      15.0  20.202020      1   POINT (20.2020202020202 15)
2      2      15.0  20.404040      1   POINT (20.4040404040404 15)
3      3      15.0  20.606061      1  POINT (20.60606060606061 15)
4      4      15.0  20.808081      1  POINT (20.80808080808081 15)
</pre></div></div>
</div>
</div>
<div class="section" id="&nbsp;Define-Exposures-from-a-GeoDataFrame-with-POINT-geometry">
<h2>&nbsp;Define Exposures from a GeoDataFrame with POINT geometry<a class="headerlink" href="# Define-Exposures-from-a-GeoDataFrame-with-POINT-geometry" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="kn">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">climada.entity</span> <span class="kn">import</span> <span class="n">Exposures</span>

<span class="c1"># Fill GeoDataFrame</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gpd</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_cities&#39;</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;World is a GeoDataFrame:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">world</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;World looks like:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Generate Exposures</span>
<span class="n">exp_gpd</span> <span class="o">=</span> <span class="n">Exposures</span><span class="p">(</span><span class="n">world</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;exp_gpd is now an Exposures:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exp_gpd</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="n">exp_gpd</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># provide value</span>
<span class="n">exp_gpd</span><span class="o">.</span><span class="n">set_lat_lon</span><span class="p">()</span> <span class="c1"># set latitude and longitude attributes from geometry</span>
<span class="n">exp_gpd</span><span class="p">[</span><span class="s1">&#39;if_TC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="c1"># provide impact functions for TC or any other peril</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;check method logs:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="n">exp_gpd</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="c1"># puts metadata that has not been assigned</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span>  <span class="o">+</span> <span class="s1">&#39;exp_gpd looks like:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">exp_gpd</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-black-intense-fg ansi-bold">World is a GeoDataFrame: &lt;class &#39;geopandas.geodataframe.GeoDataFrame&#39;&gt;</span>
<span class="ansi-black-intense-fg ansi-bold">World looks like:</span>
           name                                     geometry
0  Vatican City  POINT (12.45338654497177 41.90328217996012)
1    San Marino    POINT (12.44177015780014 43.936095834768)
2         Vaduz  POINT (9.516669472907267 47.13372377429357)
3    Luxembourg  POINT (6.130002806227083 49.61166037912108)
4       Palikir  POINT (158.1499743237623 6.916643696007725)

<span class="ansi-black-intense-fg ansi-bold">exp_gpd is now an Exposures: &lt;class &#39;climada.entity.exposures.base.Exposures&#39;&gt;</span>
2019-03-29 18:54:47,682 - climada.entity.exposures.base - INFO - Setting latitude and longitude attributes.

<span class="ansi-black-intense-fg ansi-bold">check method logs:</span>
2019-03-29 18:54:47,696 - climada.entity.exposures.base - INFO - crs set to default value: {&#39;init&#39;: &#39;epsg:4326&#39;}
2019-03-29 18:54:47,697 - climada.entity.exposures.base - INFO - tag metadata set to default value:  File:
 Description:
2019-03-29 18:54:47,697 - climada.entity.exposures.base - INFO - ref_year metadata set to default value: 2018
2019-03-29 18:54:47,698 - climada.entity.exposures.base - INFO - value_unit metadata set to default value: USD
2019-03-29 18:54:47,698 - climada.entity.exposures.base - INFO - centr_ not set.
2019-03-29 18:54:47,699 - climada.entity.exposures.base - INFO - deductible not set.
2019-03-29 18:54:47,700 - climada.entity.exposures.base - INFO - cover not set.
2019-03-29 18:54:47,701 - climada.entity.exposures.base - INFO - category_id not set.
2019-03-29 18:54:47,702 - climada.entity.exposures.base - INFO - region_id not set.

<span class="ansi-black-intense-fg ansi-bold">exp_gpd looks like:</span>
           name                                     geometry  value  \
0  Vatican City  POINT (12.45338654497177 41.90328217996012)      0
1    San Marino    POINT (12.44177015780014 43.936095834768)      1
2         Vaduz  POINT (9.516669472907267 47.13372377429357)      2
3    Luxembourg  POINT (6.130002806227083 49.61166037912108)      3
4       Palikir  POINT (158.1499743237623 6.916643696007725)      4

    latitude   longitude  if_TC
0  41.903282   12.453387      1
1  43.936096   12.441770      1
2  47.133724    9.516669      1
3  49.611660    6.130003      1
4   6.916644  158.149974      1
</pre></div></div>
</div>
</div>
<div class="section" id="&nbsp;Read-Exposures-of-an-excel-file">
<h2>&nbsp;Read Exposures of an excel file<a class="headerlink" href="# Read-Exposures-of-an-excel-file" title="Permalink to this headline">¶</a></h2>
<p>Excel files can be ingested directly following the template provided in <code class="docutils literal notranslate"><span class="pre">climada_python/data/system/entity_template.xlsx</span></code>, in the sheet <code class="docutils literal notranslate"><span class="pre">assets</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># An excel file with the variables defined in the template can be directly ingested using these commands</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">climada.util.constants</span> <span class="kn">import</span> <span class="n">ENT_TEMPLATE_XLS</span>
<span class="kn">from</span> <span class="nn">climada.entity</span> <span class="kn">import</span> <span class="n">Exposures</span>

<span class="c1"># Fill DataFrame from Excel file</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="n">ENT_TEMPLATE_XLS</span> <span class="c1"># provide absolute path of the excel file</span>
<span class="n">exp_templ</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;exp_templ is a DataFrame:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exp_templ</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;exp_templ looks like:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">exp_templ</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># Generate Exposures</span>
<span class="n">exp_templ</span> <span class="o">=</span> <span class="n">Exposures</span><span class="p">(</span><span class="n">exp_templ</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;exp_templ is now an Exposures:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exp_templ</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="n">exp_templ</span><span class="o">.</span><span class="n">set_geometry_points</span><span class="p">()</span> <span class="c1"># set geometry attribute (shapely Points) from GeoDataFrame from latitude and longitude</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;check method logs:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="n">exp_templ</span><span class="o">.</span><span class="n">check</span><span class="p">()</span> <span class="c1"># puts metadata that has not been assigned</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span>  <span class="o">+</span> <span class="s1">&#39;exp_templ looks like:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">exp_templ</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-black-intense-fg ansi-bold">exp_templ is a DataFrame: &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</span>
<span class="ansi-black-intense-fg ansi-bold">exp_templ looks like:</span>
    latitude  longitude         value  deductible         cover  region_id  \
0  26.933899 -80.128799  1.392750e+10           0  1.392750e+10          1
1  26.957203 -80.098284  1.259606e+10           0  1.259606e+10          1
2  26.783846 -80.748947  1.259606e+10           0  1.259606e+10          1
3  26.645524 -80.550704  1.259606e+10           0  1.259606e+10          1
4  26.897796 -80.596929  1.259606e+10           0  1.259606e+10          1

   category_id  if_TC  centr_TC  if_FL  centr_FL
0            1      1         1      1         1
1            1      1         2      1         2
2            1      1         3      1         3
3            1      1         4      1         4
4            1      1         5      1         5

<span class="ansi-black-intense-fg ansi-bold">exp_templ is now an Exposures: &lt;class &#39;climada.entity.exposures.base.Exposures&#39;&gt;</span>
2019-03-29 18:54:47,817 - climada.entity.exposures.base - INFO - Setting geometry attribute.

<span class="ansi-black-intense-fg ansi-bold">check method logs:</span>
2019-03-29 18:54:47,821 - climada.entity.exposures.base - INFO - crs set to default value: {&#39;init&#39;: &#39;epsg:4326&#39;}
2019-03-29 18:54:47,821 - climada.entity.exposures.base - INFO - tag metadata set to default value:  File:
 Description:
2019-03-29 18:54:47,822 - climada.entity.exposures.base - INFO - ref_year metadata set to default value: 2018
2019-03-29 18:54:47,823 - climada.entity.exposures.base - INFO - value_unit metadata set to default value: USD

<span class="ansi-black-intense-fg ansi-bold">exp_templ looks like:</span>
    latitude  longitude         value  deductible         cover  region_id  \
0  26.933899 -80.128799  1.392750e+10           0  1.392750e+10          1
1  26.957203 -80.098284  1.259606e+10           0  1.259606e+10          1
2  26.783846 -80.748947  1.259606e+10           0  1.259606e+10          1
3  26.645524 -80.550704  1.259606e+10           0  1.259606e+10          1
4  26.897796 -80.596929  1.259606e+10           0  1.259606e+10          1

   category_id  if_TC  centr_TC  if_FL  centr_FL  \
0            1      1         1      1         1
1            1      1         2      1         2
2            1      1         3      1         3
3            1      1         4      1         4
4            1      1         5      1         5

                               geometry
0          POINT (-80.128799 26.933899)
1  POINT (-80.09828400000001 26.957203)
2          POINT (-80.748947 26.783846)
3          POINT (-80.550704 26.645524)
4          POINT (-80.596929 26.897796)
</pre></div></div>
</div>
</div>
<div class="section" id="Read-Exposures-of-any-file-type-supported-by-GeoDataFrame-and-DataFrame">
<h2>Read Exposures of any file type supported by GeoDataFrame and DataFrame<a class="headerlink" href="#Read-Exposures-of-any-file-type-supported-by-GeoDataFrame-and-DataFrame" title="Permalink to this headline">¶</a></h2>
<p>Geopandas can read almost any vector-based spatial data format including ESRI shapefile, GeoJSON files and more, see <a class="reference external" href="http://geopandas.org/io.html">readers geopandas</a>. Pandas supports formats such as csv, html or sql; see <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/io.html">readers pandas</a>. Using the corresponding readers, <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> and <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> can be filled and provided to <code class="docutils literal notranslate"><span class="pre">Exposures</span></code> following the previous examples.</p>
</div>
<div class="section" id="&nbsp;Read-exposures-generated-by-CLIMADA">
<h2>&nbsp;Read exposures generated by CLIMADA<a class="headerlink" href="# Read-exposures-generated-by-CLIMADA" title="Permalink to this headline">¶</a></h2>
<p>The methods <code class="docutils literal notranslate"><span class="pre">read_mat()</span></code> will read <code class="docutils literal notranslate"><span class="pre">Exposures</span></code> generated by CLIMADA’s MATLAB version and <code class="docutils literal notranslate"><span class="pre">read_hdf5()</span></code> will read the ones generated CLIMADA in Python. These methods will allow to read all the metadata in addition to the <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>.</p>
</div>
<div class="section" id="Methods">
<h2>Methods<a class="headerlink" href="#Methods" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># read MATLAB file from climada MATLAB version with read_mat()</span>
<span class="c1"># and the ones generated with the Python version with read_hdf5()</span>
<span class="kn">from</span> <span class="nn">climada.util.constants</span> <span class="kn">import</span> <span class="n">EXP_DEMO_H5</span>

<span class="n">exp_hdf5</span> <span class="o">=</span> <span class="n">Exposures</span><span class="p">()</span>
<span class="n">exp_hdf5</span><span class="o">.</span><span class="n">read_hdf5</span><span class="p">(</span><span class="n">EXP_DEMO_H5</span><span class="p">)</span>
<span class="n">exp_hdf5</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exp_hdf5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2019-03-29 18:54:48,001 - climada.entity.exposures.base - INFO - centr_ not set.
&lt;class &#39;climada.entity.exposures.base.Exposures&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># add sea points</span>
<span class="kn">from</span> <span class="nn">climada.entity</span> <span class="kn">import</span> <span class="n">add_sea</span>
<span class="n">exp_templ_sea</span> <span class="o">=</span> <span class="n">add_sea</span><span class="p">(</span><span class="n">exp_templ</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span> <span class="c1"># 10km from coast and at 5km resolution</span>
<span class="n">exp_templ_sea</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
<span class="n">exp_templ_sea</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span> <span class="c1"># region_id set to -1 for the sea points</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2019-03-29 18:54:48,007 - climada.entity.exposures.base - INFO - Adding sea at 5 km resolution and 10 km distance from coast.
2019-03-29 18:54:49,748 - climada.entity.exposures.base - INFO - Setting geometry attribute.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>latitude</th>
      <th>longitude</th>
      <th>value</th>
      <th>deductible</th>
      <th>cover</th>
      <th>region_id</th>
      <th>category_id</th>
      <th>if_TC</th>
      <th>centr_TC</th>
      <th>if_FL</th>
      <th>centr_FL</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>58</th>
      <td>27.005495</td>
      <td>-79.939012</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>POINT (-79.93901179481654 27.00549520230383)</td>
    </tr>
    <tr>
      <th>59</th>
      <td>27.050492</td>
      <td>-80.074001</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>POINT (-80.07400099568045 27.05049160259181)</td>
    </tr>
    <tr>
      <th>60</th>
      <td>27.050492</td>
      <td>-80.029005</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>POINT (-80.02900459539248 27.05049160259181)</td>
    </tr>
    <tr>
      <th>61</th>
      <td>27.050492</td>
      <td>-79.984008</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>POINT (-79.98400819510451 27.05049160259181)</td>
    </tr>
    <tr>
      <th>62</th>
      <td>27.050492</td>
      <td>-79.939012</td>
      <td>0.0</td>
      <td>0</td>
      <td>0.0</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>POINT (-79.93901179481654 27.05049160259181)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="section" id="all-the-methods-from-GeoDataFrame">
<h3>all the methods from GeoDataFrame<a class="headerlink" href="#all-the-methods-from-GeoDataFrame" title="Permalink to this headline">¶</a></h3>
<p>Have a look into all the possible methods provided by <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>. They will allow you to perform operations like the following:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># extract data in a region: latitudes between -5 and 5</span>
<span class="n">sel_exp</span> <span class="o">=</span> <span class="n">exp_gpd</span><span class="o">.</span><span class="n">cx</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="n">sel_exp</span> <span class="c1"># the output is of type GeoDataFrame</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>geometry</th>
      <th>value</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>if_TC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9</th>
      <td>Tarawa</td>
      <td>POINT (173.0175708285494 1.338187505624603)</td>
      <td>9</td>
      <td>1.338188</td>
      <td>173.017571</td>
      <td>1</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Kigali</td>
      <td>POINT (30.05858591906411 -1.95164421006325)</td>
      <td>13</td>
      <td>-1.951644</td>
      <td>30.058586</td>
      <td>1</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Juba</td>
      <td>POINT (31.58002559278731 4.829975198277964)</td>
      <td>15</td>
      <td>4.829975</td>
      <td>31.580026</td>
      <td>1</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Bujumbura</td>
      <td>POINT (29.3600060615284 -3.376087220374643)</td>
      <td>27</td>
      <td>-3.376087</td>
      <td>29.360006</td>
      <td>1</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Kampala</td>
      <td>POINT (32.58137766712105 0.318604813383331)</td>
      <td>48</td>
      <td>0.318605</td>
      <td>32.581378</td>
      <td>1</td>
    </tr>
    <tr>
      <th>65</th>
      <td>Mogadishu</td>
      <td>POINT (45.36473175245874 2.068627192947531)</td>
      <td>65</td>
      <td>2.068627</td>
      <td>45.364732</td>
      <td>1</td>
    </tr>
    <tr>
      <th>79</th>
      <td>Quito</td>
      <td>POINT (-78.5019969671124 -0.2130423220355624)</td>
      <td>79</td>
      <td>-0.213042</td>
      <td>-78.501997</td>
      <td>1</td>
    </tr>
    <tr>
      <th>84</th>
      <td>Malabo</td>
      <td>POINT (8.783277545821136 3.750015278026183)</td>
      <td>84</td>
      <td>3.750015</td>
      <td>8.783278</td>
      <td>1</td>
    </tr>
    <tr>
      <th>90</th>
      <td>Libreville</td>
      <td>POINT (9.457965045823698 0.3853886097185182)</td>
      <td>90</td>
      <td>0.385389</td>
      <td>9.457965</td>
      <td>1</td>
    </tr>
    <tr>
      <th>98</th>
      <td>Brazzaville</td>
      <td>POINT (15.28274363384867 -4.257239913197509)</td>
      <td>98</td>
      <td>-4.257240</td>
      <td>15.282744</td>
      <td>1</td>
    </tr>
    <tr>
      <th>103</th>
      <td>Bandar Seri Begawan</td>
      <td>POINT (114.9332840566623 4.883331114619239)</td>
      <td>103</td>
      <td>4.883331</td>
      <td>114.933284</td>
      <td>1</td>
    </tr>
    <tr>
      <th>106</th>
      <td>Bangui</td>
      <td>POINT (18.55828812528728 4.366644306349087)</td>
      <td>106</td>
      <td>4.366644</td>
      <td>18.558288</td>
      <td>1</td>
    </tr>
    <tr>
      <th>107</th>
      <td>Yaounde</td>
      <td>POINT (11.51470489685443 3.868646520754112)</td>
      <td>107</td>
      <td>3.868647</td>
      <td>11.514705</td>
      <td>1</td>
    </tr>
    <tr>
      <th>124</th>
      <td>Victoria</td>
      <td>POINT (55.44998978559113 -4.6166316539734)</td>
      <td>124</td>
      <td>-4.616632</td>
      <td>55.449990</td>
      <td>1</td>
    </tr>
    <tr>
      <th>125</th>
      <td>Sao Tome</td>
      <td>POINT (6.733325153234773 0.3334021188329075)</td>
      <td>125</td>
      <td>0.333402</td>
      <td>6.733325</td>
      <td>1</td>
    </tr>
    <tr>
      <th>128</th>
      <td>Male</td>
      <td>POINT (73.499947467955 4.1667081898118)</td>
      <td>128</td>
      <td>4.166708</td>
      <td>73.499947</td>
      <td>1</td>
    </tr>
    <tr>
      <th>147</th>
      <td>Kuala Lumpur</td>
      <td>POINT (101.6980374167464 3.168611730712371)</td>
      <td>147</td>
      <td>3.168612</td>
      <td>101.698037</td>
      <td>1</td>
    </tr>
    <tr>
      <th>176</th>
      <td>Kinshasa</td>
      <td>POINT (15.31302602317174 -4.327778243275986)</td>
      <td>176</td>
      <td>-4.327778</td>
      <td>15.313026</td>
      <td>1</td>
    </tr>
    <tr>
      <th>194</th>
      <td>Nairobi</td>
      <td>POINT (36.81471100047145 -1.281400883237779)</td>
      <td>194</td>
      <td>-1.281401</td>
      <td>36.814711</td>
      <td>1</td>
    </tr>
    <tr>
      <th>196</th>
      <td>Bogota</td>
      <td>POINT (-74.08528981377441 4.598369421147822)</td>
      <td>196</td>
      <td>4.598369</td>
      <td>-74.085290</td>
      <td>1</td>
    </tr>
    <tr>
      <th>201</th>
      <td>Singapore</td>
      <td>POINT (103.853874819099 1.294979325105942)</td>
      <td>201</td>
      <td>1.294979</td>
      <td>103.853875</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># extract data in a polygon</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>

<span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)])</span>
<span class="n">sel_exp</span> <span class="o">=</span> <span class="n">exp_gpd</span><span class="p">[</span><span class="n">exp_gpd</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">poly</span><span class="p">)]</span>
<span class="n">sel_exp</span> <span class="c1"># the output is of type Exposures</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>geometry</th>
      <th>value</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>if_TC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>36</th>
      <td>Lome</td>
      <td>POINT (1.22081126074562 6.133882930268385)</td>
      <td>36</td>
      <td>6.133883</td>
      <td>1.220811</td>
      <td>1</td>
    </tr>
    <tr>
      <th>84</th>
      <td>Malabo</td>
      <td>POINT (8.783277545821136 3.750015278026183)</td>
      <td>84</td>
      <td>3.750015</td>
      <td>8.783278</td>
      <td>1</td>
    </tr>
    <tr>
      <th>113</th>
      <td>Cotonou</td>
      <td>POINT (2.518044740568598 6.401954422782467)</td>
      <td>113</td>
      <td>6.401954</td>
      <td>2.518045</td>
      <td>1</td>
    </tr>
    <tr>
      <th>125</th>
      <td>Sao Tome</td>
      <td>POINT (6.733325153234773 0.3334021188329075)</td>
      <td>125</td>
      <td>0.333402</td>
      <td>6.733325</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># change reference system</span>
<span class="n">sel_exp</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3395</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># use help to see more options: help(sel_exp.to_crs)</span>
<span class="n">sel_exp</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/aznarsig/anaconda3/envs/climada_env/lib/python3.6/site-packages/geopandas/geodataframe.py:150: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  frame[geo_column_name] = level
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;init&#39;: &#39;epsg:3395&#39;, &#39;no_defs&#39;: True}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># concatenate exposures</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">exp_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">exp_templ</span><span class="p">,</span> <span class="n">exp_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># the output is of type Exposures</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;exp_all type and number of rows:&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">exp_all</span><span class="p">),</span> <span class="n">exp_all</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># NaNs will appear in the missing values</span>
<span class="n">exp_all</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
exp_all type and number of rows: &lt;class &#39;climada.entity.exposures.base.Exposures&#39;&gt; 10024
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>latitude</th>
      <th>longitude</th>
      <th>value</th>
      <th>deductible</th>
      <th>cover</th>
      <th>region_id</th>
      <th>category_id</th>
      <th>if_TC</th>
      <th>centr_TC</th>
      <th>if_FL</th>
      <th>centr_FL</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10019</th>
      <td>35.0</td>
      <td>39.191919</td>
      <td>9995.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>POINT (39.19191919191919 35)</td>
    </tr>
    <tr>
      <th>10020</th>
      <td>35.0</td>
      <td>39.393939</td>
      <td>9996.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>POINT (39.39393939393939 35)</td>
    </tr>
    <tr>
      <th>10021</th>
      <td>35.0</td>
      <td>39.595960</td>
      <td>9997.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>POINT (39.5959595959596 35)</td>
    </tr>
    <tr>
      <th>10022</th>
      <td>35.0</td>
      <td>39.797980</td>
      <td>9998.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>POINT (39.7979797979798 35)</td>
    </tr>
    <tr>
      <th>10023</th>
      <td>35.0</td>
      <td>40.000000</td>
      <td>9999.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>POINT (40 35)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># remove values</span>
<span class="n">exp_all_1</span> <span class="o">=</span> <span class="n">exp_all</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># delete row 1</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;Row 1 deleted:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">exp_all_1</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">exp_all_val</span> <span class="o">=</span> <span class="n">exp_all</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># delete colomn &#39;value&#39;</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;Column value deleted:&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">exp_all_val</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-black-intense-fg ansi-bold">Row 1 deleted:</span>
    latitude  longitude         value  deductible         cover  region_id  \
0  26.933899 -80.128799  1.392750e+10         0.0  1.392750e+10        1.0
2  26.783846 -80.748947  1.259606e+10         0.0  1.259606e+10        1.0
3  26.645524 -80.550704  1.259606e+10         0.0  1.259606e+10        1.0
4  26.897796 -80.596929  1.259606e+10         0.0  1.259606e+10        1.0
5  26.925359 -80.220966  1.259606e+10         0.0  1.259606e+10        1.0

   category_id  if_TC  centr_TC  if_FL  centr_FL                      geometry
0          1.0      1       1.0    1.0       1.0  POINT (-80.128799 26.933899)
2          1.0      1       3.0    1.0       3.0  POINT (-80.748947 26.783846)
3          1.0      1       4.0    1.0       4.0  POINT (-80.550704 26.645524)
4          1.0      1       5.0    1.0       5.0  POINT (-80.596929 26.897796)
5          1.0      1       6.0    1.0       6.0  POINT (-80.220966 26.925359)
<span class="ansi-black-intense-fg ansi-bold">Column value deleted:</span>
    latitude  longitude  deductible         cover  region_id  category_id  \
0  26.933899 -80.128799         0.0  1.392750e+10        1.0          1.0
1  26.957203 -80.098284         0.0  1.259606e+10        1.0          1.0
2  26.783846 -80.748947         0.0  1.259606e+10        1.0          1.0
3  26.645524 -80.550704         0.0  1.259606e+10        1.0          1.0
4  26.897796 -80.596929         0.0  1.259606e+10        1.0          1.0

   if_TC  centr_TC  if_FL  centr_FL                              geometry
0      1       1.0    1.0       1.0          POINT (-80.128799 26.933899)
1      1       2.0    1.0       2.0  POINT (-80.09828400000001 26.957203)
2      1       3.0    1.0       3.0          POINT (-80.748947 26.783846)
3      1       4.0    1.0       4.0          POINT (-80.550704 26.645524)
4      1       5.0    1.0       5.0          POINT (-80.596929 26.897796)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Visualize-Exposures">
<h2>Visualize Exposures<a class="headerlink" href="#Visualize-Exposures" title="Permalink to this headline">¶</a></h2>
<p>The method <code class="docutils literal notranslate"><span class="pre">plot_hexbin()</span></code> uses <code class="docutils literal notranslate"><span class="pre">cartopy</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>’s <code class="docutils literal notranslate"><span class="pre">hexbin</span></code> function to represent the exposures values as 2d bins over a map. Configure your plot by fixing the different inputs of the method or by modifying the returned <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code> figure and axes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># execute &#39;Define Exposures from a DataFrame&#39; to see the results</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;Plotting exp_df.&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">exp_df</span><span class="o">.</span><span class="n">plot_hexbin</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span> <span class="c1"># modify x-axis borders</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span> <span class="c1"># modify y-axis borders</span>

<span class="c1"># use buffer option to enlarge borders of plot</span>
<span class="c1"># use gridsize to change bins size</span>
<span class="n">exp_df</span><span class="o">.</span><span class="n">plot_hexbin</span><span class="p">(</span><span class="n">pop_name</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">buffer</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-black-intense-fg ansi-bold">Plotting exp_df.</span>
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(&lt;Figure size 648x936 with 2 Axes&gt;,
 array([[&lt;cartopy.mpl.geoaxes.GeoAxesSubplot object at 0x1a12f90400&gt;]],
       dtype=object))
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_climada_entity_Exposures_22_2.png" src="../_images/tutorial_climada_entity_Exposures_22_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_climada_entity_Exposures_22_3.png" src="../_images/tutorial_climada_entity_Exposures_22_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># execute &#39;Define Exposures from a GeoDataFrame with POINT geometry&#39; to see the results</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[1;03;30;30m&#39;</span> <span class="o">+</span> <span class="s1">&#39;Plotting exp_gpd.&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x1b</span><span class="s1">[0m&#39;</span><span class="p">)</span>
<span class="n">exp_gpd</span><span class="o">.</span><span class="n">plot_hexbin</span><span class="p">(</span><span class="n">pop_name</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># when the geometry is changed, the plot is adapted correspondingly</span>
<span class="n">exp_gpd</span><span class="o">.</span><span class="n">to_crs</span><span class="p">({</span><span class="s1">&#39;init&#39;</span><span class="p">:</span><span class="s1">&#39;epsg:3395&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">exp_gpd</span><span class="o">.</span><span class="n">plot_hexbin</span><span class="p">(</span><span class="n">pop_name</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-black-intense-fg ansi-bold">Plotting exp_gpd.</span>
2019-03-29 18:55:01,036 - climada.entity.exposures.base - INFO - Setting latitude and longitude attributes.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(&lt;Figure size 648x936 with 2 Axes&gt;,
 array([[&lt;cartopy.mpl.geoaxes.GeoAxesSubplot object at 0x1a1311acf8&gt;]],
       dtype=object))
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_climada_entity_Exposures_23_2.png" src="../_images/tutorial_climada_entity_Exposures_23_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_climada_entity_Exposures_23_3.png" src="../_images/tutorial_climada_entity_Exposures_23_3.png" />
</div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">plot_scatter()</span></code> uses <code class="docutils literal notranslate"><span class="pre">cartopy</span></code> and <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>’s <code class="docutils literal notranslate"><span class="pre">scatter</span></code> function to represent the points values over a 2d map. As usal, it returns the figure and axes, which can be modify aftwerwards.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">exp_gpd</span><span class="o">.</span><span class="n">to_crs</span><span class="p">({</span><span class="s1">&#39;init&#39;</span><span class="p">:</span><span class="s1">&#39;epsg:3035&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">exp_gpd</span><span class="o">.</span><span class="n">plot_scatter</span><span class="p">(</span><span class="n">pop_name</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2019-03-29 18:55:17,850 - climada.entity.exposures.base - INFO - Setting latitude and longitude attributes.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(&lt;Figure size 648x936 with 2 Axes&gt;,
 array([[&lt;cartopy.mpl.geoaxes.GeoAxesSubplot object at 0x1a22a37e10&gt;]],
       dtype=object))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_climada_entity_Exposures_25_2.png" src="../_images/tutorial_climada_entity_Exposures_25_2.png" />
</div>
</div>
<p>The method <code class="docutils literal notranslate"><span class="pre">plot_raster()</span></code> rasterizes the points into the given resolution. Use the <code class="docutils literal notranslate"><span class="pre">save_tiff</span></code> option to save the resulting <code class="docutils literal notranslate"><span class="pre">tiff</span></code> file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">climada.util.plot</span> <span class="kn">import</span> <span class="n">add_cntry_names</span> <span class="c1"># use climada&#39;s plotting utilities</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">exp_df</span><span class="o">.</span><span class="n">plot_raster</span><span class="p">()</span> <span class="c1"># plot with same resolution as data</span>
<span class="n">add_cntry_names</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">exp_df</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">exp_df</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">exp_df</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">exp_df</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>

<span class="c1"># use plot_raster(save_tiff) to save the corresponding raster in tiff format</span>
<span class="c1"># change raster resolution</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">exp_df</span><span class="o">.</span><span class="n">plot_raster</span><span class="p">(</span><span class="n">raster_res</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">save_tiff</span><span class="o">=</span><span class="s1">&#39;results/exp_df.tiff&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2019-03-29 18:55:25,209 - climada.entity.exposures.base - INFO - Raster from resolution 0.20202020202019355° to 0.20202020202019355°.
2019-03-29 18:55:30,062 - climada.entity.exposures.base - INFO - Raster from resolution 0.20202020202019355° to 0.5°.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_climada_entity_Exposures_27_1.png" src="../_images/tutorial_climada_entity_Exposures_27_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_climada_entity_Exposures_27_2.png" src="../_images/tutorial_climada_entity_Exposures_27_2.png" />
</div>
</div>
<p>Finally, the method <code class="docutils literal notranslate"><span class="pre">plot_basemap()</span></code> plots the scatter points over a satellite image using <code class="docutils literal notranslate"><span class="pre">contextlily</span></code> package:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">contextily</span> <span class="kn">as</span> <span class="nn">ctx</span>
<span class="c1"># select the background image from the available ctx.sources</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">exp_templ</span><span class="o">.</span><span class="n">plot_basemap</span><span class="p">(</span><span class="nb">buffer</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">OSM_C</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;brg&#39;</span><span class="p">)</span> <span class="c1"># using open street map</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">exp_templ</span><span class="o">.</span><span class="n">plot_basemap</span><span class="p">(</span><span class="nb">buffer</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">OSM_C</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;brg&#39;</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span> <span class="c1"># set image zoom</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2019-03-29 18:55:34,593 - climada.entity.exposures.base - INFO - Setting latitude and longitude attributes.
2019-03-29 18:55:35,091 - climada.entity.exposures.base - INFO - Setting latitude and longitude attributes.
2019-03-29 18:55:35,098 - climada.entity.exposures.base - INFO - Setting latitude and longitude attributes.
2019-03-29 18:55:35,319 - climada.entity.exposures.base - INFO - Setting latitude and longitude attributes.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_climada_entity_Exposures_29_1.png" src="../_images/tutorial_climada_entity_Exposures_29_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_climada_entity_Exposures_29_2.png" src="../_images/tutorial_climada_entity_Exposures_29_2.png" />
</div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">Exposures</span></code> is a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>, any function for visualization from geopandas can be used. Check <a class="reference external" href="https://geopandas.readthedocs.io/en/latest/mapping.html#">making maps</a> and <a class="reference external" href="http://geopandas.org/gallery/index.html">examples gallery</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># other visualization types</span>
<span class="n">exp_templ</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>array([[&lt;matplotlib.axes._subplots.AxesSubplot object at 0x1a2164c828&gt;]],
      dtype=object)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_climada_entity_Exposures_31_1.png" src="../_images/tutorial_climada_entity_Exposures_31_1.png" />
</div>
</div>
</div>
<div class="section" id="Write-Exposures">
<h2>Write Exposures<a class="headerlink" href="#Write-Exposures" title="Permalink to this headline">¶</a></h2>
<p>Exposures can be saved in any format available for <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> (see fiona.supported_drivers) and <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> (<a class="reference external" href="'https://pandas.pydata.org/pandas-docs/stable/io.html'">pandas IO tools</a>). Take into account that in many of these formats the metadata (e.g. variables <code class="docutils literal notranslate"><span class="pre">ref_year</span></code>, <code class="docutils literal notranslate"><span class="pre">value_unit</span></code> and <code class="docutils literal notranslate"><span class="pre">tag</span></code>) will not be saved. Use instead the format hdf5 provided by <code class="docutils literal notranslate"><span class="pre">Exposures</span></code> methods <code class="docutils literal notranslate"><span class="pre">write_hdf5()</span></code> and <code class="docutils literal notranslate"><span class="pre">read_hdf5()</span></code> to handle all the data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># GeoDataFrame formats</span>
<span class="kn">import</span> <span class="nn">fiona</span><span class="p">;</span> <span class="n">fiona</span><span class="o">.</span><span class="n">supported_drivers</span>

<span class="c1"># GeoDataFrame default: ESRI shape file in current path. metadata not saved!</span>
<span class="n">exp_templ</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="s1">&#39;results/exp_templ&#39;</span><span class="p">)</span>

<span class="c1"># DataFrame save to csv format. geometry writen as string, metadata not saved!</span>
<span class="n">exp_templ</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;results/exp_templ_csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># write</span>
<span class="n">exp_templ</span><span class="o">.</span><span class="n">write_hdf5</span><span class="p">(</span><span class="s1">&#39;results/exp_temp.h5&#39;</span><span class="p">)</span>
<span class="c1"># read</span>
<span class="n">exp_read</span> <span class="o">=</span> <span class="n">Exposures</span><span class="p">()</span>
<span class="n">exp_read</span><span class="o">.</span><span class="n">read_hdf5</span><span class="p">(</span><span class="s1">&#39;results/exp_temp.h5&#39;</span><span class="p">)</span>
<span class="n">exp_read</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/aznarsig/anaconda3/envs/climada_env/lib/python3.6/site-packages/IPython/core/interactiveshell.py:3291: PerformanceWarning:
your performance may suffer as PyTables will pickle object types that it cannot
map directly to c-types [inferred_type-&gt;mixed,key-&gt;block2_values] [items-&gt;[&#39;geometry&#39;]]

  exec(code_obj, self.user_global_ns, self.user_ns)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>latitude</th>
      <th>longitude</th>
      <th>value</th>
      <th>deductible</th>
      <th>cover</th>
      <th>region_id</th>
      <th>category_id</th>
      <th>if_TC</th>
      <th>centr_TC</th>
      <th>if_FL</th>
      <th>centr_FL</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>26.933899</td>
      <td>-80.128799</td>
      <td>1.392750e+10</td>
      <td>0</td>
      <td>1.392750e+10</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>POINT (-80.12879899999999 26.93389899999996)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>26.957203</td>
      <td>-80.098284</td>
      <td>1.259606e+10</td>
      <td>0</td>
      <td>1.259606e+10</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>2</td>
      <td>POINT (-80.09828400000001 26.957203)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>26.783846</td>
      <td>-80.748947</td>
      <td>1.259606e+10</td>
      <td>0</td>
      <td>1.259606e+10</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>3</td>
      <td>POINT (-80.748947 26.78384599999999)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26.645524</td>
      <td>-80.550704</td>
      <td>1.259606e+10</td>
      <td>0</td>
      <td>1.259606e+10</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
      <td>1</td>
      <td>4</td>
      <td>POINT (-80.550704 26.64552399999997)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>26.897796</td>
      <td>-80.596929</td>
      <td>1.259606e+10</td>
      <td>0</td>
      <td>1.259606e+10</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>5</td>
      <td>POINT (-80.596929 26.89779599999998)</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Finallly, as with any Python object, use climada’s save option to save it in pickle format.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># save in pickle format</span>
<span class="kn">from</span> <span class="nn">climada.util.save</span> <span class="kn">import</span> <span class="n">save</span>
<span class="c1"># this generates a results folder in the current path and stores the output there</span>
<span class="n">save</span><span class="p">(</span><span class="s1">&#39;exp_templ.pkl.p&#39;</span><span class="p">,</span> <span class="n">exp_templ</span><span class="p">)</span> <span class="c1"># creates results folder and stores there</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2019-03-29 18:55:35,894 - climada.util.save - INFO - Written file /Users/aznarsig/Documents/Python/climada_python/script/tutorial/results/exp_templ.pkl.p
</pre></div></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, ETH Zurich.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>